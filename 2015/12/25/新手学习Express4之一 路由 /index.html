<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>新手学习Express4之一:路由 | 我的后院自留地</title>
  <meta name="author" content="okuc">
  
  <meta name="description" content="hadoop hive hbase cassandra linux elasticsearch eclipse java mysql">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="新手学习Express4之一:路由"/>
  <meta property="og:site_name" content="我的后院自留地"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="我的后院自留地" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  


<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7ea69d6de48b6d7cd2a53bcc519beadc";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">我的后院自留地</a></h1>
  <h2><a href="/">琴棋书画诗酒花 当年件件不离它 而今事事都变更 柴米油盐酱醋茶</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/archives">归档</a></li>
    
      <li><a href="/coding">编程技术</a></li>
    
      <li><a href="/bigData">大数据技术</a></li>
    
      <li><a href="/dataV">数据可视化</a></li>
    
      <li><a href="/about">关于</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-12-25T14:06:32.000Z"><a href="/2015/12/25/新手学习Express4之一 路由 /">2015-12-25</a></time>
      
      
  
    <h1 class="title">新手学习Express4之一:路由</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="路由">路由</h2><ol>
<li><p>路由由一个URI、HTTP请求和若干个句柄组成，它的结构如下：<code>app.METHOD(path,[callback...],callback)</code>。<code>app</code>是<code>express</code>对象的一个实例，<code>METHOD</code>是一个HTTP请求方法，<code>path</code>是服务器上的路径，<code>callback</code>是当路由匹配时要执行的函数。</p>
<p>下面是一个基本的示例：</p>
</li>
</ol>
<pre><code>    var express = require('express');
    var app = express();

    //当主页收到GET请求时，返回hello world
    app.get('/',function(req,res){
        res.send('hello world');
    });


 <span class="comment">&lt;!--more--&gt;</span>
<span class="tag">&lt;<span class="title">a</span> <span class="attribute">id</span>=<span class="value">"more"</span>&gt;</span><span class="tag">&lt;/<span class="title">a</span>&gt;</span>
</code></pre><ol>
<li>路由方法是HTTP请求的方法，和<code>express</code>实例相关联。上面的例子就是个<code>GET</code>路由方法，下面一个<code>POST</code>路由方法的例子：</li>
</ol>
<pre><code>    var express = require('express')<span class="comment">;</span>
    var app = express()<span class="comment">;</span>

    //当主页收到GET请求时，返回hello world
    app.post('/',function(req,res){
        res.send('hello world')<span class="comment">;</span>
    })<span class="comment">;</span>

<span class="escape">`e</span>xpress<span class="escape">`定</span>义了和HTTP请求对应的如下方法： <span class="escape">`g</span>et<span class="escape">` </span>、 <span class="escape">`p</span>ost<span class="escape">` </span>、 <span class="escape">`p</span>ut<span class="escape">` </span>、 <span class="escape">`h</span>ead<span class="escape">` </span>、 <span class="escape">`d</span>elete<span class="escape">` </span>、 <span class="escape">`o</span>ptions<span class="escape">` </span>、 <span class="escape">`t</span>race<span class="escape">` </span>、 <span class="escape">`c</span>opy<span class="escape">` </span>、 <span class="escape">`l</span>ock<span class="escape">` </span>、 <span class="escape">`m</span>kcol<span class="escape">` </span>、 <span class="escape">`m</span>ove<span class="escape">` </span>、 <span class="escape">`p</span>urge<span class="escape">` </span>、 <span class="escape">`p</span>ropfind<span class="escape">` </span>、 <span class="escape">`p</span>roppatch<span class="escape">` </span>、 <span class="escape">`u</span>nlock<span class="escape">` </span>、 <span class="escape">`r</span>eport<span class="escape">` </span>、 <span class="escape">`m</span>kactivity<span class="escape">` </span>、 <span class="escape">`c</span>heckout<span class="escape">` </span>、 <span class="escape">`m</span>erge<span class="escape">` </span>、 <span class="escape">`m</span>-search<span class="escape">` </span>、 <span class="escape">`n</span>otify<span class="escape">` </span>、 <span class="escape">`s</span>ubscribe<span class="escape">` </span>、 <span class="escape">`u</span>nsubscribe<span class="escape">` </span>、 <span class="escape">`p</span>atch<span class="escape">` </span>、 <span class="escape">`s</span>earch<span class="escape">` </span>和 <span class="escape">`c</span>onnect<span class="escape">`。</span>

有些路由方法名不是合规的JavaScript变量名，此时使用括号记法，比如<span class="escape">`a</span>pp['m-search']('/',function...<span class="escape">`
</span>
<span class="escape">`a</span>pp.all()<span class="escape">`是</span>一个特殊的路由方法，没有任何HTTP方法与其对应，它的作用是对于一个路径上的所有请求加载中间件。如下例，只要路径对，任何方法(<span class="escape">`G</span>ET<span class="escape">`、</span><span class="escape">`P</span>OST<span class="escape">`等</span>)的请求都能执行。

    app.all('/secret', function (req, res, next) {
    console.log('Accessing the secret section ...')<span class="comment">;</span>
    next()<span class="comment">; // 交给下一个句柄处理</span>
    })<span class="comment">;</span>
</code></pre><ol>
<li><p>路由路径和请求方法一起定义了请求的端点，它可以是字符串、字符串模式或者正则表达式。</p>
<p><code>express</code>使用<a href="https://www.npmjs.com/package/path-to-regexp" target="_blank" rel="external">path-to-regex</a>匹配路由路径，具体可查阅文档。 <a href="http://forbeslindesay.github.io/express-route-tester/" target="_blank" rel="external">Express Route Tester</a> 是测试基本 Express 路径的好工具，但不支持模式匹配。</p>
<p>下面是一些例子：</p>
<pre><code><span class="comment">// 匹配根路径的请求</span>
app.<span class="keyword">get</span>(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> </span>{
res.send(<span class="string">'root'</span>);
});
<span class="comment">// 匹配 /about 路径的请求</span>
app.<span class="keyword">get</span>(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> </span>{
res.send(<span class="string">'about'</span>);
});
<span class="comment">// 匹配 /random.text 路径的请求</span>
app.<span class="keyword">get</span>(<span class="string">'/random.text'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> </span>{
res.send(<span class="string">'random.text'</span>);
});

<span class="comment">//使用字符串模式的路由路径示例：</span>

<span class="comment">// 匹配 acd 和 abcd</span>
app.<span class="keyword">get</span>(<span class="string">'/ab?cd'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
res.send(<span class="string">'ab?cd'</span>);
});
<span class="comment">// 匹配 abcd、abbcd、abbbcd等app.get('/ab+cd', function(req, res) {</span>
res.send(<span class="string">'ab+cd'</span>);
});
<span class="comment">// 匹配 abcd、abxcd、abRABDOMcd、ab123cd等</span>
app.<span class="keyword">get</span>(<span class="string">'/ab*cd'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
res.send(<span class="string">'ab*cd'</span>);
});
<span class="comment">// 匹配 /abe 和 /abcde</span>
app.<span class="keyword">get</span>(<span class="string">'/ab(cd)?e'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
res.send(<span class="string">'ab(cd)?e'</span>);
});
<span class="comment">//字符 ?、+、* 和 () 是正则表达式的子集，- 和 . 在基于字符串的路径中按照字面值解释。</span>

<span class="comment">//使用正则表达式的路由路径示例：</span>

<span class="comment">// 匹配任何路径中含有 a 的路径：</span>
app.<span class="keyword">get</span>(/a/, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
res.send(<span class="string">'/a/'</span>);
});
<span class="comment">// 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等</span>
app.<span class="keyword">get</span>(/.*fly$/, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> </span>{
res.send(<span class="string">'/.*fly$/'</span>);
});
</code></pre></li>
<li><p>句柄路由：可以为请求处理多个回调函数，其行为类似中间件()。唯一的区别是这些回调函数有可能调用<code>next(&#39;route&#39;)</code>方法而略过其他路由回调函数。可以利用该机制为路由定义前提条件，如果在现有的路径上继续执行没有意义，则可将控制权交给剩下的路径。</p>
<p>路由路柄有多种形式，可以是一个函数，一个函数数组，或者是两者混合。</p>
<pre><code><span class="comment">//使用一个回调函数处理路由：</span>
app.get(<span class="string">'/example/a'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>{
res.send(<span class="string">'Hello from A!'</span>);
});

<span class="comment">//使用多个回调函数处理路由（记得指定 next 对象）：</span>
app.get(<span class="string">'/example/b'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>{
<span class="built_in">console</span>.log(<span class="string">'response will be sent by the next function ...'</span>);
next();
}, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>{
res.send(<span class="string">'Hello from B!'</span>);
});

<span class="comment">//使用回调函数数组处理路由：</span>
<span class="keyword">var</span> cb0 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>{
<span class="built_in">console</span>.log(<span class="string">'CB0'</span>);
next();
}
<span class="keyword">var</span> cb1 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>{
<span class="built_in">console</span>.log(<span class="string">'CB1'</span>);
next();
}
<span class="keyword">var</span> cb2 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>{
res.send(<span class="string">'Hello from C!'</span>);
}
app.get(<span class="string">'/example/c'</span>, [cb0, cb1, cb2]);

<span class="comment">//混合使用函数和函数数组处理路由：</span>
<span class="keyword">var</span> cb0 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>{
<span class="built_in">console</span>.log(<span class="string">'CB0'</span>);
next();
}
<span class="keyword">var</span> cb1 = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>{
<span class="built_in">console</span>.log(<span class="string">'CB1'</span>);
next();
}
app.get(<span class="string">'/example/d'</span>, [cb0, cb1], <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>{
<span class="built_in">console</span>.log(<span class="string">'response will be sent by the next function ...'</span>);
next();
}, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>{
res.send(<span class="string">'Hello from D!'</span>);
});
</code></pre></li>
</ol>
<ol>
<li><p>响应方法</p>
<ul>
<li><code>res.download()</code>： <a href="http://expressjs.com/4x/api.html#res.download" target="_blank" rel="external">http://expressjs.com/4x/api.html#res.download)</a>提示下载文件。</li>
<li><code>res.end()</code>： <a href="http://expressjs.com/4x/api.html#res.end" target="_blank" rel="external">http://expressjs.com/4x/api.html#res.end</a>终结响应。</li>
<li><code>res.json()</code>： <a href="http://expressjs.com/4x/api.html#res.json" target="_blank" rel="external">http://expressjs.com/4x/api.html#res.json</a>发送一个 JSON 响应。</li>
<li><code>res.jsonp()</code>： <a href="http://expressjs.com/4x/api.html#res.jsonp" target="_blank" rel="external">http://expressjs.com/4x/api.html#res.jsonp</a>发送一个支持 JSONP 的 JSON 响应。</li>
<li><code>res.redirect()</code>： <a href="http://expressjs.com/4x/api.html#res.redirect" target="_blank" rel="external">http://expressjs.com/4x/api.html#res.redirect</a>重定向请求。</li>
<li><code>res.render()</code>： <a href="http://expressjs.com/4x/api.html#res.render" target="_blank" rel="external">http://expressjs.com/4x/api.html#res.render</a>渲染视图模板。</li>
<li><code>res.send()</code>： <a href="http://expressjs.com/4x/api.html#res.send" target="_blank" rel="external">http://expressjs.com/4x/api.html#res.send</a>发送各种类型的响应。</li>
<li><code>res.sendFile（）</code>： <a href="http://expressjs.com/4x/api.html#res.sendFile" target="_blank" rel="external">http://expressjs.com/4x/api.html#res.sendFile</a>以八位字节流的形式发送文件。</li>
<li><code>res.sendStatus()</code>： <a href="http://expressjs.com/4x/api.html#res.sendStatus" target="_blank" rel="external">http://expressjs.com/4x/api.html#res.sendStatus</a>设置响应状态代码，并将其以字符串形式作为响应体的一部分发送。</li>
</ul>
</li>
<li><p><code>app.route()</code>可用来创建链式路由句柄，它的路径在一个地方指定，这样做有助于创建模块化的路由，而且减少了代码冗余和拼写错误。具体可参考这儿：<a href="http://expressjs.com/4x/api.html#router" target="_blank" rel="external">http://expressjs.com/4x/api.html#router</a>。</p>
<p>下面是一个例子：</p>
</li>
</ol>
<pre><code>app.route(<span class="string">'/book'</span>)
.<span class="built_in">get</span>(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span>
<span class="keyword">res</span>.send(<span class="string">'Get a random book'</span>);
})
.post(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span>
<span class="keyword">res</span>.send(<span class="string">'Add a book'</span>);
}).<span class="keyword">put</span>(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span>
<span class="keyword">res</span>.send(<span class="string">'Update the book'</span>);
});
</code></pre><ol>
<li><p><code>express.Router</code>可用来创建模块化、可挂载的路由句柄。<code>Router</code>实例是一个完整的中间件和路由系统，因此常称其为一个<code>mini-app</code>。</p>
<p>下面的实例程序创建了一个路由模块，并加载了一个中间件，定义了一些路由，并且将它们挂载至应用的路径上。</p>
<p><code>birds.js</code>源代码：</p>
<pre><code><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
<span class="keyword">var</span> router = express.Router();
<span class="comment">// 该路由使用的中间件</span>
router.use(<span class="function"><span class="keyword">function</span> <span class="title">timeLog</span>(<span class="params">req, res, next</span>) </span>{
<span class="built_in">console</span>.log(<span class="string">'Time: '</span>, <span class="built_in">Date</span>.now());
next();
});
<span class="comment">// 定义主页路由</span>
router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
res.send(<span class="string">'Birds home page'</span>);
});
<span class="comment">// 定义 about 路由</span>
router.get(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
res.send(<span class="string">'About birds'</span>);
});
<span class="built_in">module</span>.exports = router;
</code></pre></li>
</ol>
<pre><code>在应用中加载路由模块源代码：

    var birds = require(‘./birds’)<span class="comment">;</span>
     …
     app.use(‘/birds’, birds)<span class="comment">;</span>

应用即可处理发自<span class="escape">`/</span>birds<span class="escape">`和</span><span class="escape">`/</span>birds/about<span class="escape">`的</span>请求，并且调用为该路由指定的<span class="escape">`t</span>imeLog<span class="escape">`中</span>间件。
</code></pre>
      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/Nodejs/">Nodejs</a>, <a href="/tags/express/">express</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<nav id="pagination" >
    
    <a href="/2015/12/28/新手学习Express4之二：中间件与模板引擎/" class="alignleft prev" >Vorherige Seite</a>
    
    
    <a href="/2015/12/21/新手学习mongodb之九：聚合管道/" class="alignright next" >Nächste Seite</a>
    
    <div class="clearfix"></div>
</nav>

<!-- ��˵���ۿ� start -->
 <div class="ds-thread" data-thread-key="/2015/12/25/新手学习Express4之一 路由 /" data-title="新手学习Express4之一:路由" data-url="http://www.52brt.com/2015/12/25/新手学习Express4之一 路由 /"></div>
<!-- ��˵���ۿ� end -->
<!-- ��˵����JS���� start (һ����ҳֻ������һ��) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"okuc"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- ��˵����JS���� end -->
<section id="comment">
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Angularjs/">Angularjs</a><small>6</small></li>
  
    <li><a href="/tags/Bootstrap/">Bootstrap</a><small>5</small></li>
  
    <li><a href="/tags/HBase/">HBase</a><small>1</small></li>
  
    <li><a href="/tags/Nodejs/">Nodejs</a><small>7</small></li>
  
    <li><a href="/tags/TinkerPop3/">TinkerPop3</a><small>1</small></li>
  
    <li><a href="/tags/centos/">centos</a><small>2</small></li>
  
    <li><a href="/tags/docker/">docker</a><small>1</small></li>
  
    <li><a href="/tags/eclipse/">eclipse</a><small>1</small></li>
  
    <li><a href="/tags/eclipse插件开发/">eclipse插件开发</a><small>1</small></li>
  
    <li><a href="/tags/elasticsearch/">elasticsearch</a><small>6</small></li>
  
    <li><a href="/tags/express/">express</a><small>4</small></li>
  
    <li><a href="/tags/hexo/">hexo</a><small>1</small></li>
  
    <li><a href="/tags/java/">java</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>5</small></li>
  
    <li><a href="/tags/markdown/">markdown</a><small>2</small></li>
  
    <li><a href="/tags/maven/">maven</a><small>1</small></li>
  
    <li><a href="/tags/mongodb/">mongodb</a><small>9</small></li>
  
    <li><a href="/tags/mysql/">mysql</a><small>1</small></li>
  
    <li><a href="/tags/nodejs/">nodejs</a><small>1</small></li>
  
    <li><a href="/tags/svg/">svg</a><small>1</small></li>
  
    <li><a href="/tags/titan/">titan</a><small>1</small></li>
  
    <li><a href="/tags/tomcat/">tomcat</a><small>1</small></li>
  
    <li><a href="/tags/前端/">前端</a><small>17</small></li>
  
    <li><a href="/tags/可视化/">可视化</a><small>1</small></li>
  
    <li><a href="/tags/图数据库/">图数据库</a><small>1</small></li>
  
    <li><a href="/tags/恢复/">恢复</a><small>1</small></li>
  
    <li><a href="/tags/数据库/">数据库</a><small>9</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 okuc
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>